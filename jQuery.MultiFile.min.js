/* jquery-multifile v2.0.0 @ 2014-04-15 11:04:00 */window.jQuery&&function(a){"use strict";a.fn.MultiFile=function(b){if(0==this.length)return this;if("string"==typeof arguments[0]){if(this.length>1){var c=arguments;return this.each(function(){a.fn.MultiFile.apply(a(this),c)})}return a.fn.MultiFile[arguments[0]].apply(this,a.makeArray(arguments).slice(1)||[]),this}var b=a.extend({},a.fn.MultiFile.options,b||{});a("form").not("MultiFile-intercepted").addClass("MultiFile-intercepted").submit(a.fn.MultiFile.disableEmpty),a.fn.MultiFile.options.autoIntercept&&(a.fn.MultiFile.intercept(a.fn.MultiFile.options.autoIntercept),a.fn.MultiFile.options.autoIntercept=null),this.not(".MultiFile-applied").addClass("MultiFile-applied").each(function(){window.MultiFile=(window.MultiFile||0)+1;var c=window.MultiFile,d={e:this,E:a(this),clone:a(this).clone()};"number"==typeof b&&(b={max:b});var e=a.extend({},a.fn.MultiFile.options,b||{},(a.metadata?d.E.metadata():a.meta?d.E.data():null)||{},{});e.max>0||(e.max=d.E.attr("maxlength")),e.max>0||(e.max=(String(d.e.className.match(/\b(max|limit)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],e.max=e.max>0?String(e.max).match(/[0-9]+/gi)[0]:-1),e.max=new Number(e.max),e.accept=e.accept||d.E.attr("accept")||"",e.accept||(e.accept=d.e.className.match(/\b(accept\-[\w\|]+)\b/gi)||"",e.accept=new String(e.accept).replace(/^(accept|ext)\-/i,"")),e.maxsize>0||(e.maxsize=(String(d.e.className.match(/\b(maxsize|size)\-([0-9]+)\b/gi)||[""]).match(/[0-9]+/gi)||[""])[0],e.maxsize=e.maxsize>0?String(e.maxsize).match(/[0-9]+/gi)[0]:-1),a.extend(d,e||{}),d.STRING=a.extend({},a.fn.MultiFile.options.STRING,d.STRING),a.extend(d,{n:0,slaves:[],files:[],instanceKey:d.e.id||"MultiFile"+String(c),generateID:function(a){return d.instanceKey+(a>0?"_F"+String(a):"")},trigger:function(b,c){var e=d[b],f=a(c).attr("value");if(e){var g=e(c,f,d);if(null!=g)return g}return!0}}),String(d.accept).length>1&&(d.accept=d.accept.replace(/\W+/g,"|").replace(/^\W|\W$/g,""),d.rxAccept=new RegExp("\\.("+(d.accept?d.accept:"")+")$","gi")),d.wrapID=d.instanceKey+"_wrap",d.E.wrap('<div class="MultiFile-wrap" id="'+d.wrapID+'"></div>'),d.wrapper=a("#"+d.wrapID),d.e.name=d.e.name||"file"+c+"[]",d.list||(d.wrapper.append('<div class="MultiFile-list" id="'+d.wrapID+'_list"></div>'),d.list=a("#"+d.wrapID+"_list")),d.list=a(d.list),d.addSlave=function(b,e){d.n++,b.MultiFile=d,e>0&&(b.id=b.name=""),e>0&&(b.id=d.generateID(e)),b.name=String(d.namePattern.replace(/\$name/gi,a(d.clone).attr("name")).replace(/\$id/gi,a(d.clone).attr("id")).replace(/\$g/gi,c).replace(/\$i/gi,e)),d.max>0&&d.files.length>d.max&&(b.disabled=!0),d.current=d.slaves[e]=b,b=a(b),b.val("").attr("value","")[0].value="",b.addClass("MultiFile-applied"),b.change(function(){function c(a){return a>1048576?(a/1048576).toFixed(1)+"Mb":(a/1048576).toFixed(1)+"Kb"}if(a(this).blur(),!d.trigger("onFileSelect",this,d))return!1;var f=this.files||[{name:this.value,size:0,type:((this.value||"").match(/[^\.]+$/i)||[""])[0]}],g=d.total_size||0,h=[];a.each(f,function(a,b){var c=b.name;d.accept&&c&&!c.match(d.rxAccept)&&(h[h.length]=d.STRING.denied.replace("$ext",String(c.match(/[^\.]+$/i))));for(var e in d.slaves)d.slaves[e]&&d.slaves[e]!=this&&d.slaves[e].value==c&&(h[h.length]=d.STRING.duplicate.replace("$file",c.match(/[^\/\\]+$/gi)));g+=b.size}),d.maxsize>0&&g>d.maxsize&&(h[h.length]=d.STRING.oversize.replace("$size",c(g)+" > "+c(d.maxsize)));var i=a(d.clone).clone();return i.addClass("MultiFile"),h.length>0?(d.error(h.join("\n")),d.n--,d.addSlave(i[0],e),b.parent().prepend(i),b.remove(),!1):(d.total_size=g,d.files=(d.files||[]).concat(f),a(this).css({position:"absolute",top:"-3000px"}),b.after(i),d.addSlave(i[0],e+1),d.addToList(this,e,f),d.trigger("afterFileSelect",this,d)?void 0:!1)}),a(b).data("MultiFile",d)},d.addToList=function(b,c,e){return d.trigger("onFileAppend",b,d)?(a.each(e,function(e,f){var g=a('<div class="MultiFile-label"></div>'),h=String(f.name||""),i=a('<span class="MultiFile-title" title="'+d.STRING.selected.replace("$file",h)+'">'+d.STRING.file.replace("$file",h.match(/[^\/\\]+$/gi)[0])+"</span>"),j=a('<a class="MultiFile-remove" href="#'+d.wrapID+'">'+d.STRING.remove+"</a>").click(function(){return d.trigger("onFileRemove",b,d)?(d.n--,d.current.disabled=!1,d.slaves[c]=null,a(b).remove(),a(this).parent().remove(),a(d.current).css({position:"",top:""}),a(d.current).reset().val("").attr("value","")[0].value="",d.trigger("afterFileRemove",b,d)?!1:!1):!1});d.list.append(g.append(j," ",i))}),d.trigger("afterFileAppend",b,d)?void 0:!1):!1},d.MultiFile||d.addSlave(d.e,0),d.n++,d.E.data("MultiFile",d)})},a.extend(a.fn.MultiFile,{reset:function(){var b=a(this).data("MultiFile");return b&&b.list.find("a.MultiFile-remove").click(),a(this)},disableEmpty:function(b){b=("string"==typeof b?b:"")||"mfD";var c=[];return a("input:file.MultiFile").each(function(){""==a(this).val()&&(c[c.length]=this)}),a(c).each(function(){this.disabled=!0}).addClass(b)},reEnableEmpty:function(b){return b=("string"==typeof b?b:"")||"mfD",a("input:file."+b).removeClass(b).each(function(){this.disabled=!1})},intercepted:{},intercept:function(b,c,d){var e,f;if(d=d||[],d.constructor.toString().indexOf("Array")<0&&(d=[d]),"function"==typeof b)return a.fn.MultiFile.disableEmpty(),f=b.apply(c||window,d),setTimeout(function(){a.fn.MultiFile.reEnableEmpty()},1e3),f;b.constructor.toString().indexOf("Array")<0&&(b=[b]);for(var g=0;g<b.length;g++)e=b[g]+"",e&&function(b){a.fn.MultiFile.intercepted[b]=a.fn[b]||function(){},a.fn[b]=function(){return a.fn.MultiFile.disableEmpty(),f=a.fn.MultiFile.intercepted[b].apply(this,arguments),setTimeout(function(){a.fn.MultiFile.reEnableEmpty()},1e3),f}}(e)}}),a.fn.MultiFile.options={accept:"",max:-1,namePattern:"$name",STRING:{remove:"x",denied:"You cannot select a $ext file.\nTry again...",file:"$file",selected:"File selected: $file",duplicate:"This file has already been selected:\n$file",oversize:"The files selected exceed the maximum size permited ($size bytes)"},autoIntercept:["submit","ajaxSubmit","ajaxForm","validate","valid"],error:function(a){console.log(a),alert(a)}},a.fn.reset=function(){return this.each(function(){try{this.reset()}catch(a){}})},a(function(){a("input[type=file].multi").MultiFile()})}(jQuery);